"use strict";var _createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var map,DBHelper=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"fetchRestaurants",value:function(){return fetch(a.DATABASE_URL).then(function(a){return a.json()})}},{key:"fetchRestaurantById",value:function(b){return fetch(a.DATABASE_URL+("/"+b)).then(function(a){return a.json()})}},{key:"fetchRestaurantByCuisine",value:function(b){return a.fetchRestaurants().then(function(){return restaurants.filter(function(a){return a.cuisine_type==b})})}},{key:"fetchRestaurantByNeighborhood",value:function(b){return a.fetchRestaurants().then(function(){return restaurants.filter(function(a){return a.neighborhood==b})})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(b,c){return a.fetchRestaurants().then(function(a){return"all"==b?"all"==c?a:a.filter(function(a){return a.neighborhood==c}):a.filter(function(a){return a.cuisine_type==b})})}},{key:"fetchNeighborhoods",value:function(){return a.fetchRestaurants().then(function(a){return a.map(function(b,c){return a[c].neighborhood}).filter(function(a,b,c){return c.indexOf(a)==b})})}},{key:"fetchCuisines",value:function(){return a.fetchRestaurants().then(function(a){return a.map(function(b,c){return a[c].cuisine_type}).filter(function(a,b,c){return c.indexOf(a)==b})})}},{key:"urlForRestaurant",value:function(a){return"./restaurant.html?id="+a.id}},{key:"imageUrlForRestaurant",value:function(a){return"/img/"+a.photograph}},{key:"mapMarkerForRestaurant",value:function(b,c){var d=new google.maps.Marker({position:b.latlng,title:b.name,url:a.urlForRestaurant(b),map:c,animation:google.maps.Animation.DROP});return d}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337/restaurants"}}]),a}(),restaurant=void 0;window.initMap=function(){registerServiceWorker(),fetchRestaurantFromURL().then(function(a){self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:a.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map)}).catch(console.error)};var registerServiceWorker=function(){"serviceWorker"in navigator&&navigator.serviceWorker.register("./sw.js",{scope:"./"})},fetchRestaurantFromURL=function(){if(self.restaurant)return Promise.resolve(self.restaurant);var a=getParameterByName("id");return a?DBHelper.fetchRestaurantById(a).then(function(a){return self.restaurant=a,fillRestaurantHTML(),a}):Promise.reject("No restaurant id in URL")},fillRestaurantHTML=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:self.restaurant,b=document.getElementById("restaurant-name");b.innerHTML=a.name;var c=document.getElementById("restaurant-address");c.innerHTML=a.address;var d=document.getElementById("restaurant-img");d.className="restaurant-img",d.alt="Photo of the "+a.name+" restaurant";var e=DBHelper.imageUrlForRestaurant(a);d.src=e+"-480.jpg",d.srcset=e+"-480.jpg 1x, "+e+"-800.jpg 2x";var f=document.getElementById("restaurant-cuisine");f.innerHTML=a.cuisine_type,a.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()},fillRestaurantHoursHTML=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:self.restaurant.operating_hours,b=document.getElementById("restaurant-hours"),c=b.querySelector("tbody");for(var d in a){var e=document.createElement("tr"),f=document.createElement("th");f.classList.add("left"),f.innerHTML=d,e.appendChild(f);var g=document.createElement("td");g.classList.add("right");var h=document.createElement("span");h.innerHTML=a[d],g.appendChild(h),e.appendChild(g),c.appendChild(e)}},fillReviewsHTML=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.reviews,b=document.getElementById("reviews-container"),c=document.createElement("h2");if(c.innerHTML="Reviews",b.appendChild(c),!a){var d=document.createElement("p");return d.innerHTML="No reviews yet!",void b.appendChild(d)}var e=document.getElementById("reviews-list");a.forEach(function(a){e.appendChild(createReviewHTML(a))}),b.appendChild(e)},createReviewHTML=function(a){var b=document.createElement("li");b.classList.add("card");var c=document.createElement("span");c.classList.add("username"),c.innerHTML=a.name,b.appendChild(c);var d=document.createElement("span");d.classList.add("date"),d.innerHTML=a.date,b.appendChild(d);var e=document.createElement("p");e.classList.add("rating"),e.innerHTML="\u2605".repeat(a.rating),b.appendChild(e);var f=document.createElement("p");return f.classList.add("comments"),f.innerHTML=a.comments,b.appendChild(f),b},fillBreadcrumb=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:self.restaurant,b=document.getElementById("breadcrumb"),c=document.createElement("li");c.innerHTML=a.name,c.setAttribute("aria-current","page"),b.appendChild(c)},getParameterByName=function(a,b){b||(b=window.location.href),a=a.replace(/[\[\]]/g,"\\$&");var c=new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)"),d=c.exec(b);return d?d[2]?decodeURIComponent(d[2].replace(/\+/g," ")):"":null};