"use strict";var _createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var map,DBHelper=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"fetchRestaurants",value:function(b){var c=new XMLHttpRequest;c.open("GET",a.DATABASE_URL),c.onload=function(){if(200===c.status){var a=JSON.parse(c.responseText),d=a.restaurants;b(null,d)}else{var e="Request failed. Returned status of "+c.status;b(e,null)}},c.send()}},{key:"fetchRestaurantById",value:function(b,c){a.fetchRestaurants(function(a,d){if(a)c(a,null);else{var e=d.find(function(a){return a.id==b});e?c(null,e):c("Restaurant does not exist",null)}})}},{key:"fetchRestaurantByCuisine",value:function(b,c){a.fetchRestaurants(function(a,d){if(a)c(a,null);else{var e=d.filter(function(a){return a.cuisine_type==b});c(null,e)}})}},{key:"fetchRestaurantByNeighborhood",value:function(b,c){a.fetchRestaurants(function(a,d){if(a)c(a,null);else{var e=d.filter(function(a){return a.neighborhood==b});c(null,e)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(b,c,d){a.fetchRestaurants(function(a,e){if(a)d(a,null);else{var f=e;"all"!=b&&(f=f.filter(function(a){return a.cuisine_type==b})),"all"!=c&&(f=f.filter(function(a){return a.neighborhood==c})),d(null,f)}})}},{key:"fetchNeighborhoods",value:function(b){a.fetchRestaurants(function(a,c){if(a)b(a,null);else{var d=c.map(function(a,b){return c[b].neighborhood}),e=d.filter(function(a,b){return d.indexOf(a)==b});b(null,e)}})}},{key:"fetchCuisines",value:function(b){a.fetchRestaurants(function(a,c){if(a)b(a,null);else{var d=c.map(function(a,b){return c[b].cuisine_type}),e=d.filter(function(a,b){return d.indexOf(a)==b});b(null,e)}})}},{key:"urlForRestaurant",value:function(a){return"./restaurant.html?id="+a.id}},{key:"imageUrlForRestaurant",value:function(a){return"/img/"+a.photograph}},{key:"mapMarkerForRestaurant",value:function(b,c){var d=new google.maps.Marker({position:b.latlng,title:b.name,url:a.urlForRestaurant(b),map:c,animation:google.maps.Animation.DROP});return d}},{key:"DATABASE_URL",get:function(){return"/data/restaurants.json"}}]),a}(),restaurant=void 0;window.initMap=function(){registerServiceWorker(),fetchRestaurantFromURL(function(a,b){a?console.error(a):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:b.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})},registerServiceWorker=function(){"serviceWorker"in navigator&&navigator.serviceWorker.register("./sw.js",{scope:"./"})},fetchRestaurantFromURL=function(a){if(self.restaurant)return void a(null,self.restaurant);var b=getParameterByName("id");b?DBHelper.fetchRestaurantById(b,function(b,c){return self.restaurant=c,c?void(fillRestaurantHTML(),a(null,c)):void console.error(b)}):(error="No restaurant id in URL",a(error,null))},fillRestaurantHTML=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:self.restaurant,b=document.getElementById("restaurant-name");b.innerHTML=a.name;var c=document.getElementById("restaurant-address");c.innerHTML=a.address;var d=document.getElementById("restaurant-img");d.className="restaurant-img",d.alt="Photo of the "+a.name+" restaurant";var e=DBHelper.imageUrlForRestaurant(a).slice(0,-4);d.src=e+"-480.jpg",d.srcset=e+"-480.jpg 1x, "+e+"-800.jpg 2x";var f=document.getElementById("restaurant-cuisine");f.innerHTML=a.cuisine_type,a.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()},fillRestaurantHoursHTML=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:self.restaurant.operating_hours,b=document.getElementById("restaurant-hours"),c=b.querySelector("tbody");for(var d in a){var e=document.createElement("tr"),f=document.createElement("th");f.classList.add("left"),f.innerHTML=d,e.appendChild(f);var g=document.createElement("td");g.classList.add("right");var h=document.createElement("span");h.innerHTML=a[d],g.appendChild(h),e.appendChild(g),c.appendChild(e)}},fillReviewsHTML=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.reviews,b=document.getElementById("reviews-container"),c=document.createElement("h2");if(c.innerHTML="Reviews",b.appendChild(c),!a){var d=document.createElement("p");return d.innerHTML="No reviews yet!",void b.appendChild(d)}var e=document.getElementById("reviews-list");a.forEach(function(a){e.appendChild(createReviewHTML(a))}),b.appendChild(e)},createReviewHTML=function(a){var b=document.createElement("li");b.classList.add("card");var c=document.createElement("span");c.classList.add("username"),c.innerHTML=a.name,b.appendChild(c);var d=document.createElement("span");d.classList.add("date"),d.innerHTML=a.date,b.appendChild(d);var e=document.createElement("p");e.classList.add("rating"),e.innerHTML="\u2605".repeat(a.rating),b.appendChild(e);var f=document.createElement("p");return f.classList.add("comments"),f.innerHTML=a.comments,b.appendChild(f),b},fillBreadcrumb=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:self.restaurant,b=document.getElementById("breadcrumb"),c=document.createElement("li");c.innerHTML=a.name,c.setAttribute("aria-current","page"),b.appendChild(c)},getParameterByName=function(a,b){b||(b=window.location.href),a=a.replace(/[\[\]]/g,"\\$&");var c=new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)"),d=c.exec(b);return d?d[2]?decodeURIComponent(d[2].replace(/\+/g," ")):"":null};